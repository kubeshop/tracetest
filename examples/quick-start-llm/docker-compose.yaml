services:
  app:
    build: ./app
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - OTEL_SERVICE_NAME=quick-start-llm
      - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    ports:
      - 8051:8051
    depends_on:
      - otel-collector

  otel-collector:
    command:
      - --config
      - /otel-local-config.yaml
    depends_on:
      jaeger:
        condition: service_started
    image: otel/opentelemetry-collector:0.108.0
    ports:
      - 4317:4317
    volumes:
      - type: bind
        source: ./observability/otelcollector.config.yaml
        target: /otel-local-config.yaml

  jaeger:
    healthcheck:
      test:
        - CMD
        - wget
        - --spider
        - localhost:16686
      timeout: 3s
      interval: 1s
      retries: 60
    image: jaegertracing/all-in-one:latest
    restart: unless-stopped
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    ports:
      - 16686:16686



openapi: 3.0.0
info:
  version: 0.0.1
  title: TraceTest
  description: OpenAPI definition for TraceTest endpoint and resources
servers:
  - url: /api
paths:
  /tests:
    get:
      tags:
        - api
      summary: "Create new test"
      description: "get tests"
      operationId: getTests
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Test"
        500:
          description: "problem with creating test"
          # content:
          #   application/problem+json:
          #     schema:
          #       type: array
          #       items:
          #         $ref: "#/components/schemas/Problem"
    post:
      tags:
        - api
      summary: "Create new test"
      description: "Create new test action"
      operationId: createTest
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Test"
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Test"
        500:
          description: "problem with creating test"
          # content:
          #   application/problem+json:
          #     schema:
          #       type: array
          #       items:
          #         $ref: "#/components/schemas/Problem"
  /tests/{testid}:
    get:
      tags:
        - api
      parameters:
        - in: path
          name: testid
          schema:
            type: string
          required: true
      summary: "get test"
      description: "get test"
      operationId: getTest
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Test"
        500:
          description: "problem with creating test"
  /tests/{testid}/run:
    post:
      tags:
        - api
      parameters:
        - in: path
          name: testid
          schema:
            type: string
          required: true
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestRun"

  /tests/{testid}/results/{id}:
    get:
      tags:
        - api
      parameters:
        - in: path
          name: testid
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Result"

  /tests/{testid}/results/{id}/trace:
    get:
      tags:
        - api
      parameters:
        - in: path
          name: testid
          schema:
            type: string
          required: true
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        200:
          description: trace
          content:
            application/json:
              schema:
                type: object

  /tests/{id}/results:
    get:
      tags:
        - api
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Result"
  /tests/{id}/assertions:
    get:
      tags:
        - api
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      operationId: getAssertions
      description: "Gets all assertions associated to the test"
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Assertion"
    post:
      tags:
        - api
      description: ""
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      operationId: createAssertion
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Assertion"
      responses:
        "200":
          description: OK

components:
  schemas:
    Test:
      type: object
      properties:
        id:
          type: string
          description: ID
          readOnly: true
        name:
          type: string
        description:
          type: string
        serviceUnderTest:
          type: object
          properties:
            id:
              type: string
              description: ID
              readOnly: true
            url:
              type: string
              description: URL of the service under test
            auth:
              type: string
              description: authorization data for the request
        assertions:
          type: array
          items:
            $ref: "#/components/schemas/Assertion"
          description: Definition of assertions that are going to be made
        repeats:
          type: integer
        results:
          type: array
          items:
            $ref: "#/components/schemas/Result"
          description: Test results
        version:
          type: string
          description: version of the test
        parent_test: 
          type: string
          description: refernece to the previous version of test
    Assertion:
      type: object
      properties:
        id:
          type: string
          description: ID
          readOnly: true
        selector:
          description: Defines the scope where the sought property/ies is located
          type: string
        comparable:
          description: Defines the expected value of the property/ies
          type: string
        operator:
          description: |
            Defines how the value of sought property/ies should be compared
            For example lt (less then), gt (greater then), eq (equals), in (contains)
          type: string
        successful:
          type: boolean
    Result:
      type: object
      properties:
        id:
          type: string
          description: ID
          readOnly: true
        testid:
          type: string
          description: test ID
          readOnly: true
        traceid:
          type: string
          description: trace ID
          readOnly: true
        spanid:
          type: string
          description: parent span ID
          readOnly: true
        successful:
          $ref: "#/components/schemas/Assertion"
        failed:
          $ref: "#/components/schemas/Assertion"
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
    Attribute:
      type: object
      properties:
        id:
          type: string
          description: ID
          readOnly: true
        key:
          type: string
        value:
          type: string
    TestRun:
      type: object
      properties:
        id:
          type: string
          description: ID
          readOnly: true

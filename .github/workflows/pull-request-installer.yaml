name: Installer Pull Request
on:
  push:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
    branches:
      - main
    paths:
      - install-cli.sh

jobs:
  linux:
    name: Linux
    strategy:
      matrix:
        distro: [ubuntu, fedora, alpine]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: ${{ matrix.distro }}
      uses: addnab/docker-run-action@v3
      with:
        image: ${{matrix.distro}}
        options: -v ${{ github.workspace }}:/app -e COMMIT=$GITHUB_SHA
        run: |
          echo
          echo "ARCH"
          uname -p
          echo

          case "${{ matrix.distro }}" in
            ubuntu*|jessie|stretch|buster|bullseye)
              apt-get update -q -y
              apt-get install -q -y curl
              ;;
            fedora*)
              yum install -y curl --refresh
              ;;
            alpine*)
              apk add --update curl
              ;;
          esac

          curl -L https://raw.githubusercontent.com/kubeshop/tracetest/${COMMIT}/install-cli.sh | sh
          tracetest

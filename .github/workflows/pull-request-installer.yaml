name: Installer Pull Request
on:
  push:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
    branches:
      - main
    paths:
      - install-cli.sh

jobs:
  linux:
    name: Linux
    strategy:
      matrix:
        distro: [ubuntu_latest, fedora_latest, alpine_latest]
        arch: [armv7, aarch64]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - uses: uraimo/run-on-arch-action@v2
      name: install on ${{ matrix.distro }} ${{ matrix.arch }}
      with:
        distro: ${{ matrix.distro }}
        arch: ${{ matrix.arch }}
        install: |
          case "${{ matrix.distro }}" in
            ubuntu*|jessie|stretch|buster|bullseye)
              apt-get update -q -y
              apt-get install -q -y curl
              ;;
            fedora*)
              yum install -y curl --refresh
              ;;
            alpine*)
              apk add --update curl
              ;;
          esac
        run: |
          curl -L https://raw.githubusercontent.com/kubeshop/tracetest/main/install-cli.sh | bash
          tracetest

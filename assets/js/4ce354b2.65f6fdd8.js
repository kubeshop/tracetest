"use strict";(self.webpackChunktracetest_docs=self.webpackChunktracetest_docs||[]).push([[4559],{14187:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>l,frontMatter:()=>c,metadata:()=>i,toc:()=>u});var t=n(74848),o=n(28453);const c={},r="Websocket endpoint",i={id:"websocket",title:"Websocket endpoint",description:"Tracetest allow you to subscribe to updates of resources using websockets. There are two endpoints that you can use to manage subscriptions:",source:"@site/docs/websocket.md",sourceDirName:".",slug:"/websocket",permalink:"/websocket",draft:!1,unlisted:!1,editUrl:"https://github.com/kubeshop/tracetest/blob/main/docs/docs/websocket.md",tags:[],version:"current",frontMatter:{}},a={},u=[{value:"Endpoint",id:"endpoint",level:2},{value:"Messages",id:"messages",level:2},{value:"Subscribing to updates",id:"subscribing-to-updates",level:3},{value:"Cancel a susbcription",id:"cancel-a-susbcription",level:3}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"websocket-endpoint",children:"Websocket endpoint"}),"\n",(0,t.jsx)(s.p,{children:"Tracetest allow you to subscribe to updates of resources using websockets. There are two endpoints that you can use to manage subscriptions:"}),"\n",(0,t.jsx)(s.h2,{id:"endpoint",children:"Endpoint"}),"\n",(0,t.jsxs)(s.p,{children:["You can open a websocket connection by sending a request the path ",(0,t.jsx)(s.code,{children:"/ws"}),". Example: ",(0,t.jsx)(s.code,{children:"ws://localhost:11633/ws"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"messages",children:"Messages"}),"\n",(0,t.jsx)(s.h3,{id:"subscribing-to-updates",children:"Subscribing to updates"}),"\n",(0,t.jsx)(s.p,{children:"Once the connection is open, you can send a message with the format:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "type": "subscribe",\n    "resource": "test/{testID}/run/{runID}"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"If a problem happens, you will see an error like:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "type": "error",\n    "message": "details of the error"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"If the operation executes successfully, you will see a response like:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "type": "success",\n    "resource": "test/{testID}/run/{runID}",\n    "message": {\n        "subscriptionId": "bdbc6cc8-bba6-4208-a8d3-d3c2c5b3e38b"\n    }\n}\n'})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"subscriptionId"})," is an important field because it is required to cancel the subscription. You should store it, otherwise you will keep receiving updates of a resource that you might not want."]}),"\n",(0,t.jsx)(s.h3,{id:"cancel-a-susbcription",children:"Cancel a susbcription"}),"\n",(0,t.jsxs)(s.p,{children:["Once you have a subscription to a resource, you might want to stop receiving events from that resource. So, there is a ",(0,t.jsx)(s.code,{children:"unsubscribe"})," message that you can send to achieve that."]}),"\n",(0,t.jsx)(s.p,{children:"But send this message to the websocket connection:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "type": "unsubscribe",\n    "resource": "test/{testID}/run/{runID}",\n    "subscriptionId": "id returned in the subscription command"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"You will receive an error message if any required field is not field. But in case of a successful operation, you will receive a message like:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "type":"success",\n    "message":"ok"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"This message will be sent regardless if the subscription exists or not."})]})}function l(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>i});var t=n(96540);const o={},c=t.createContext(o);function r(e){const s=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(c.Provider,{value:s},e.children)}}}]);
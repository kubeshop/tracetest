"use strict";(self.webpackChunktracetest_docs=self.webpackChunktracetest_docs||[]).push([[2662],{73232:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var n=s(74848),i=s(28453);const r={id:"check-shopping-cart-contents",title:"OpenTelemetry Store - Check shopping cart contents",description:"The OpenTelemetry Demo is an example application published by the OpenTelemtry CNCF project. This use case covers seeing all the products in the shopping cart.",hide_table_of_contents:!1,keywords:["tracetest","trace-based testing","observability","distributed tracing","testing"],image:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1698686403/docs/Blog_Thumbnail_14_rsvkmo.jpg"},o=void 0,c={id:"live-examples/opentelemetry-store/use-cases/check-shopping-cart-contents",title:"OpenTelemetry Store - Check shopping cart contents",description:"The OpenTelemetry Demo is an example application published by the OpenTelemtry CNCF project. This use case covers seeing all the products in the shopping cart.",source:"@site/docs/live-examples/opentelemetry-store/use-cases/check-shopping-cart-contents.mdx",sourceDirName:"live-examples/opentelemetry-store/use-cases",slug:"/live-examples/opentelemetry-store/use-cases/check-shopping-cart-contents",permalink:"/live-examples/opentelemetry-store/use-cases/check-shopping-cart-contents",draft:!1,unlisted:!1,editUrl:"https://github.com/kubeshop/tracetest/blob/main/docs/docs/live-examples/opentelemetry-store/use-cases/check-shopping-cart-contents.mdx",tags:[],version:"current",frontMatter:{id:"check-shopping-cart-contents",title:"OpenTelemetry Store - Check shopping cart contents",description:"The OpenTelemetry Demo is an example application published by the OpenTelemtry CNCF project. This use case covers seeing all the products in the shopping cart.",hide_table_of_contents:!1,keywords:["tracetest","trace-based testing","observability","distributed tracing","testing"],image:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1698686403/docs/Blog_Thumbnail_14_rsvkmo.jpg"},sidebar:"guidesSidebar",previous:{title:"OpenTelemetry Store - Add item into the shopping cart",permalink:"/live-examples/opentelemetry-store/use-cases/add-item-into-shopping-cart"},next:{title:"OpenTelemetry Store - Checkout",permalink:"/live-examples/opentelemetry-store/use-cases/checkout"}},a={},l=[{value:"Building a Test for This Scenario",id:"building-a-test-for-this-scenario",level:2},{value:"Traces",id:"traces",level:3},{value:"Assertions",id:"assertions",level:3},{value:"Test Definition",id:"test-definition",level:3}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"In this use case, we want to validate the following story:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"As a consumer\nI want to see my shopping cart\nAnd see all products that I've added to it\nSo I can go to the checkout process\n"})}),"\n",(0,n.jsxs)(t.p,{children:["You can trigger this use case by calling the endpoint ",(0,n.jsx)(t.code,{children:"GET /api/cart?sessionId={some-uuid}&currecyCode="})," from the Frontend service. It should return a payload similar to this:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-json",children:'{\n  "userId": "8c0465e2-32bb-4ecb-a9c8-5a2861629ff1",\n  "items": [\n    {\n      "productId": "66VCHSJNUP",\n      "quantity" : 1,\n      "product": {\n        "id": "66VCHSJNUP",\n        "name": "Starsense Explorer Refractor Telescope",\n        "description": "The first telescope that uses your smartphone to analyze the night sky and calculate its position in real time. StarSense Explorer is ideal for beginners thanks to the app\u2019s user-friendly interface and detailed tutorials. It\u2019s like having your own personal tour guide of the night sky",\n        "picture": "/images/products/StarsenseExplorer.jpg",\n        "priceUsd": {\n          "currencyCode": "USD",\n          "units": 349,\n          "nanos": 950000000\n        },\n        "categories": [\n          "telescopes"\n        ]\n      }\n    }\n  ]\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["If it is the first time that you are calling this endpoint, to see an item into the shopping cart you need first to ",(0,n.jsx)(t.a,{href:"/live-examples/opentelemetry-store/use-cases/add-item-into-shopping-cart",children:"Add item into shopping cart"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"building-a-test-for-this-scenario",children:"Building a Test for This Scenario"}),"\n",(0,n.jsxs)(t.p,{children:["Using Tracetest, we can ",(0,n.jsx)(t.a,{href:"/web-ui/creating-tests",children:"create a test"})," that will execute an API call on ",(0,n.jsx)(t.code,{children:"GET /api/cart?sessionId={some-uuid}&currecyCode="})," and validate the following properties:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The product ID ",(0,n.jsx)(t.code,{children:"66VCHSJNUP"}),", previously added, exists in the cart."]}),"\n",(0,n.jsx)(t.li,{children:"The size of the shopping cart should be 1."}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"traces",children:"Traces"}),"\n",(0,n.jsxs)(t.p,{children:["Running these tests for the first time will create an Observability trace like the image below, where you can see spans for the API calls (HTTP and gRPC):\n",(0,n.jsx)(t.img,{src:s(70513).A+"",width:"1964",height:"2110"})]}),"\n",(0,n.jsx)(t.h3,{id:"assertions",children:"Assertions"}),"\n",(0,n.jsxs)(t.p,{children:["With this trace, now we can build ",(0,n.jsx)(t.a,{href:"/concepts/assertions",children:"assertions"})," on Tracetest and validate the properties:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsxs)(t.strong,{children:["The product ID ",(0,n.jsx)(t.code,{children:"66VCHSJNUP"}),", previously added, exists in the cart."]}),"\n",(0,n.jsx)(t.img,{src:s(553).A+"",width:"3698",height:"980"})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"The size of the shopping cart should be 1."}),"\n",(0,n.jsx)(t.img,{src:s(55776).A+"",width:"3630",height:"836"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Now you can validate this entire use case."}),"\n",(0,n.jsx)(t.h3,{id:"test-definition",children:"Test Definition"}),"\n",(0,n.jsxs)(t.p,{children:["To replicate this entire test on Tracetest, you can replicate these steps on our Web UI or using our CLI, saving the following test definition as the file ",(0,n.jsx)(t.code,{children:"test-definition.yml"})," and later running:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sh",children:"tracetest run test -f test-definition.yml\n"})}),"\n",(0,n.jsxs)(t.p,{children:["We are assuming that the Frontend service is exposed on ",(0,n.jsx)(t.code,{children:"http://otel-demo-frontend:8080"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'type: Test\nspec:\n  name: OpenTelemetry Store - Check shopping cart contents\n  trigger:\n    type: http\n    httpRequest:\n      url: http://otel-demo-frontend:8080/api/cart?sessionId=8c0465e2-32bb-4ecb-a9c8-5a2861629ff1&currencyCode=\n      method: GET\n      headers:\n      - key: Content-Type\n        value: application/json\n  specs:\n  - selector: span[tracetest.span.type="rpc" name="hipstershop.ProductCatalogService/GetProduct"\n      rpc.system="grpc" rpc.method="GetProduct" rpc.service="hipstershop.ProductCatalogService"]\n    assertions:\n    - attr:app.product.id = "66VCHSJNUP"\n  - selector: span[tracetest.span.type="general" name="Tracetest trigger"]\n    assertions:\n    - attr:tracetest.response.body | json_path \'$.items.length\' = 1\n'})})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},55776:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/check-shopping-cart-contents-item-lenght-33e6123291430b6b901dda80e48402e0.png"},553:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/check-shopping-cart-contents-product-catalog-0582743911bbdd3d848651669029e22b.png"},70513:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/check-shopping-cart-contents-trace-c68512eb7e71171e211107ef3633cace.png"},28453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>c});var n=s(96540);const i={},r=n.createContext(i);function o(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);
---
id: configure-trace-ingestion
title: Configure Trace Ingestion
description: Get started by configuring trace ingestion to connect traces to tests. Tracetest allows you to quickly build integration and end-to-end tests, powered by your OpenTelemetry traces.
hide_table_of_contents: false
keywords:
  - tracetest
  - trace-based testing
  - observability
  - distributed tracing
  - testing
  - trace ingestion
  - trace testing
  - ingest traces
image: https://res.cloudinary.com/djwdcmwdz/image/upload/v1698686403/docs/Blog_Thumbnail_14_rsvkmo.jpg
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import GtagInstallCliTabs from '@site/src/components/GtagInstallCliTabs';

[Tracetest Agent](/concepts/agent) runs alongside your apps, in the same environment/network, to do two things:

1. Run tests against your apps.
2. Ingest traces from your apps.

This page explains (2), how to ingest traces into Tracetest Agent to enable trace-based testing.

## Enable Trace Ingestion with an OTLP Endpoint

Create a file called `trace-ingestion.yaml`. And, run it with the CLI.

```yaml title="trace-ingestion.yaml"
type: DataStore
spec:
  name: Opentelemetry Collector pipeline
  type: otlp
  default: true
```

```bash title="Terminal"
tracetest apply datastore -f ./trace-ingestion.yaml
```

Or, use the Web UI. Go to Settings > Trace Ingestion. Toggle "Enable Trace Ingestion" to on and select OpenTelemetry.

<p align="center">
  <img src="https://res.cloudinary.com/djwdcmwdz/image/upload/v1727178199/docs/app.tracetest.io_organizations_ttorg_e66318ba6544b856_environments_ttenv_ed85b0979257d37b_tests_page_1_3_l0v8wp.png" alt="trace ingestion 1" width="50%" />
  <img src="https://res.cloudinary.com/djwdcmwdz/image/upload/v1727178201/docs/app.tracetest.io_organizations_ttorg_e66318ba6544b856_environments_ttenv_ed85b0979257d37b_tests_page_1_4_fyhu3d.png" alt="trace ingestion 2" width="50%" />
</p>

## Configure Trace Exporters to Send Traces to Tracetest Agent

Once configured, Tracetest Agent exposes OTLP ports `4317` (gRPC) and `4318` (HTTP) for trace ingestion. Configure your trace exporters to send traces to the Tracetest Agent OTLP endpoint.

<Tabs groupId="installation">
<TabItem value="cli" label="Tracetest CLI" default>

With the Tracetest Agent running locally, the trace ingestion OTLP endpoints will be:

- gRPC: `http://localhost:4317`
- HTTP: `http://localhost:4318/v1/traces`

</TabItem>
<TabItem value="docker" label="Docker">

With the Tracetest Agent running in Docker with `tracetest-agent` as the service name, the trace ingestion OTLP endpoints will be:

- gRPC: `http://tracetest-agent:4317`
- HTTP: `http://tracetest-agent:4318/v1/traces`

</TabItem>
<TabItem value="docker-compose" label="Docker Compose">

With the Tracetest Agent running in Docker with `tracetest-agent` as the service name, the trace ingestion OTLP endpoints will be:

- gRPC: `http://tracetest-agent:4317`
- HTTP: `http://tracetest-agent:4318/v1/traces`

</TabItem>
<TabItem value="kubernetes" label="Kubernetes">

With the Tracetest Agent running in Kubernetes with `tracetest-agent` as the service name, the trace ingestion OTLP endpoints will be:

- gRPC: `http://tracetest-agent.default.svc.cluster.local:4317`
- HTTP: `http://tracetest-agent.default.svc.cluster.local:4318/v1/traces`

</TabItem>
<TabItem value="helm" label="Helm">

With the Tracetest Agent running in Kubernetes with `agent` as the Helm `<release-name>`, the trace ingestion OTLP endpoints will be:

- gRPC: `http://agent-tracetest-agent:4317`
- HTTP: `http://agent-tracetest-agent:4318/v1/traces`

</TabItem>
</Tabs>

<Tabs groupId="exporters">
<TabItem value="nodejs" label="Node.js" default>

1. Install Dependecies

```bash title="Terminal"
npm install --save @opentelemetry/auto-instrumentations-node
```

2. Initilize Tracing

Create an initialization file called `tracing.js`. Import it as the first step in your application lifecycle or include it with the `-r` / `--require` Node.js CLI option.

```js title="tracing.js"
const opentelemetry = require('@opentelemetry/sdk-node');
const { OTLPTraceExporter } =  require('@opentelemetry/exporter-trace-otlp-http');
const { getNodeAutoInstrumentations } = require('@opentelemetry/auto-instrumentations-node');

const sdk = new opentelemetry.NodeSDK({
  // environment vars are loaded in the start step
  traceExporter: new OTLPTraceExporter(),
  instrumentations: [
    getNodeAutoInstrumentations({
      // we recommend disabling fs autoinstrumentation since it can be noisy and expensive during startup
      '@opentelemetry/instrumentation-fs': {
          enabled: false,
      },
    }),
  ],
});

sdk.start();
```

3. Configure and Run

Configure OpenTelemetry to send traces to Tracetest using environment variables. Run the Node.js app by preloading the OpenTelemetry initialization file with `-r`.

```bash title="Terminal"
export OTEL_SERVICE_NAME=my-service-name
export OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
export OTEL_EXPORTER_OTLP_ENDPOINT="http://<tracetest-agent>:4318"
export OTEL_EXPORTER_OTLP_HEADERS="x-tracetest-token=<token>"

node -r ./tracing.js app.js
```

</TabItem>
<TabItem value="python" label="Python">

1. Install Packages

```bash
python -m pip install opentelemetry-instrumentation \
                      opentelemetry-distro \
                      opentelemetry-exporter-otlp
```

2. Initilize Tracing

```bash
opentelemetry-bootstrap --action=install
```

3. Configure and Run

Configure OpenTelemetry to send traces to Tracetest using environment variables. Run the Node.js app by preloading the OpenTelemetry initialization file with `-r`.

```bash
export OTEL_SERVICE_NAME=my-service-name
export OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
export OTEL_EXPORTER_OTLP_ENDPOINT="http://<tracetest-agent>:4318"
export OTEL_EXPORTER_OTLP_HEADERS="x-tracetest-token=<token>"

opentelemetry-instrument python app.py
```

</TabItem>
<TabItem value="go" label="Go">

1. Install Dependecies

```bash
go get github.com/honeycombio/otel-config-go/otelconfig \
       go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp
```

2. Initialize Tracing

Update your `main.go` file.

```go
package main

import (
    "fmt"
    "log"
    "net/http"

    "github.com/honeycombio/otel-config-go/otelconfig"
    "go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp"
)

// Implement an HTTP Handler func to be instrumented
func httpHandler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello, World")
}

// Wrap the HTTP handler func with OTel HTTP instrumentation
func wrapHandler() {
    handler := http.HandlerFunc(httpHandler)
    wrappedHandler := otelhttp.NewHandler(handler, "hello")
    http.Handle("/hello", wrappedHandler)
}

func main() {
    // use otelconfig to setup OpenTelemetry SDK
    otelShutdown, err := otelconfig.ConfigureOpenTelemetry()
    if err != nil {
        log.Fatalf("error setting up OTel SDK - %e", err)
    }
    defer otelShutdown()

    // Initialize HTTP handler instrumentation
    wrapHandler()
    log.Fatal(http.ListenAndServe(":3030", nil))
}
```

</TabItem>
<TabItem value="kubernetes" label="Kubernetes">

With the Tracetest Agent running in Kubernetes with `tracetest-agent` as the service name, the trace ingestion OTLP endpoints will be:

- gRPC: `http://tracetest-agent.default.svc.cluster.local:4317`
- HTTP: `http://tracetest-agent.default.svc.cluster.local:4318/v1/traces`

</TabItem>
<TabItem value="helm" label="Helm">

With the Tracetest Agent running in Kubernetes with `agent` as the Helm `<release-name>`, the trace ingestion OTLP endpoints will be:

- gRPC: `http://agent-tracetest-agent:4317`
- HTTP: `http://agent-tracetest-agent:4318/v1/traces`

</TabItem>
</Tabs>

:::note Need more detailed guidance?
[Refer to the Trace Ingestion docs, here.](/configuration/connecting-to-data-stores/overview)
:::

:::tip Don't have OpenTelemetry installed?
[Follow these instructions to install OpenTelemetry in 5 minutes without any code changes!](./no-otel.mdx)
:::
